var $event = {
    "salesOrderId": null,
    "fuLineItemIds": null,
    "pod": null,
    "customFields": [],
    "loadInfo": {
        "material": "Bulk Crates,Non-Cratable,Carton Box,Bags,Metal Cage",
        "valueOfGoods": 0,
        "standardMeasurement": {
            "volume": null,
            "packageMeasurement": {
                "actualDeliveredQuantity": null,
                "density": null,
                "netQuantity": 151,
                "moisture": null,
                "claimQuantity": null,
                "unitOfMeasurment": "unit",
                "standardQuantity": 151,
                "actualLoadedQuantity": null,
                "measurmentType": "package",
                "grossQuantity": 151,
                "shortage": null,
                "temperature": null,
                "plannedLoadQuantity": null,
                "frieghtDeductableQuantity": null
            },
            "weight": null,
            "containers": null,
            "trucks": null
        },
        "currency": null,
        "measurements": [{
            "actualDeliveredQuantity": null,
            "density": null,
            "netQuantity": 207,
            "moisture": null,
            "claimQuantity": null,
            "unitOfMeasurment": "unit",
            "standardQuantity": 207,
            "actualLoadedQuantity": null,
            "measurmentType": "package",
            "grossQuantity": 207,
            "shortage": null,
            "temperature": null,
            "plannedLoadQuantity": null,
            "frieghtDeductableQuantity": null
        }]
    },
    "customerPsnNo": null,
    "invoiceValue": "0.0",
    "updates": {
        "traceID": "47158899-6752-4a85-8a3f-5a25ff46cbfc",
        "resourceId": "d9d3833e-c269-4142-8663-883914f141bb",
        "updatedBy": "SYSTEM",
        "changes": null,
        "sourceOfInformation": null,
        "description": null,
        "forwardReasons": ["ensure.lineitem.and.mapping"],
        "userId": null,
        "uuid": "2abdd07a-cb33-423a-9a5e-3ccbb8708dea",
        "revision": 2,
        "time": 1684913634216,
        "forwardedFrom": null,
        "resourceType": "Consignment",
        "updateType": null
    },
    "uuid": "d9d3833e-c269-4142-8663-883914f141bb",
    "orgId": "06acac7f-5697-4fef-9a61-eef47f75367a",
    "consigner": {
        "geoFence": null,
        "documents": null,
        "customFields": null,
        "isPortalEnabled": false,
        "type": null,
        "updates": null,
        "uuid": "FAKE",
        "orgId": "06acac7f-5697-4fef-9a61-eef47f75367a",
        "firmType": null,
        "gstn": null,
        "voterId": null,
        "verificationTicketId": null,
        "group": {
            "name": "Consignor",
            "partnerType": null,
            "uuid": null,
            "orgId": null
        },
        "address": null,
        "verificationStatus": null,
        "externalId": null,
        "panNumber": null,
        "aadharNo": null,
        "parentId": null,
        "places": [{
            "hubId": null,
            "boundary": null,
            "address": "SUPERMARKET GROCERY SUPPLIES PVT LTD(BIGBASKET))WH No 01, Sector 67Noida 201309",
            "accessibility": "public",
            "addedBy": "06acac7f-5697-4fef-9a61-eef47f75367a",
            "center": {
                "latitude": 28.608450587384,
                "longitude": 77.387772404113
            },
            "suggestedRadius": 500,
            "isOwned": true,
            "centerCoordinates": [77.387772404113, 28.608450587384],
            "placeId": "10c31222-d870-4f60-b073-bc9fe74b1815",
            "geoJsonBoundry": null,
            "externalId": "",
            "source": "FRETRON",
            "places": null,
            "viewport": null,
            "district": null,
            "name": "Noida Sec 67",
            "state": null,
            "category": "5K",
            "subDistrict": null,
            "controllingBranchId": null
        }],
        "route": null,
        "name": "Noida Sec 67",
        "location": null,
        "fretronId": null,
        "contacts": null,
        "status": null
    },
    "lineItems": [
        {
            "itemNumber": "1",
            "transportationServiceId": null,
            "material": {
                "unitOfMeasurement": null,
                "measuredQuantity": null,
                "partnerName": null,
                "materialType": null,
                "externalId": null,
                "updates": null,
                "taxCode": null,
                "uuid": "FAKE",
                "orgId": null,
                "pricePerUnit": null,
                "materialDescription": null,
                "division": null,
                "controlCode": null,
                "materialGroup": null,
                "materialGroupId": null,
                "name": "Bulk Crates",
                "measurementType": null,
                "partnerId": null,
                "linkedMaterialId": null
            },
            "valueOfGoods": null,
            "customFields": null,
            "externalId": null,
            "invoiceNo": null,
            "customerMaterial": null,
            "uuid": "66a136bd-a4a1-480e-8350-2a8d638a3648"
        }, {
            "itemNumber": "3",
            "transportationServiceId": null,
            "material": {
                "unitOfMeasurement": null,
                "measuredQuantity": null,
                "partnerName": null,
                "materialType": null,
                "externalId": null,
                "updates": null,
                "taxCode": null,
                "uuid": "FAKE",
                "orgId": null,
                "pricePerUnit": null,
                "materialDescription": null,
                "division": null,
                "controlCode": null,
                "materialGroup": null,
                "materialGroupId": null,
                "name": "Carton Box",
                "measurementType": null,
                "partnerId": null,
                "linkedMaterialId": null
            },
            "valueOfGoods": null,
            "customFields": null,
            "externalId": null,
            "invoiceNo": null,
            "customerMaterial": null,
            "uuid": "5bfbda22-f5cb-4fd1-95c3-bb2b619fa06f"
        }, {
            "itemNumber": "5",
            "transportationServiceId": null,
            "material": {
                "unitOfMeasurement": null,
                "measuredQuantity": null,
                "partnerName": null,
                "materialType": null,
                "externalId": null,
                "updates": null,
                "taxCode": null,
                "uuid": "FAKE",
                "orgId": null,
                "pricePerUnit": null,
                "materialDescription": null,
                "division": null,
                "controlCode": null,
                "materialGroup": null,
                "materialGroupId": null,
                "name": "Metal Cage",
                "measurementType": null,
                "partnerId": null,
                "linkedMaterialId": null
            },
            "valueOfGoods": null,
            "customFields": null,
            "externalId": null,
            "invoiceNo": null,
            "customerMaterial": null,
            "uuid": "0646fd63-4d53-416a-a0f2-6db1f6e48563"
        }],
    "pssNo": null,
    "eWayBillNumber": null,
    "billingType": null,
    "podDocument": null,
    "invoiceNo": null,
    "deliveryDate": null,
    "associatedShipments": ["ab0e0c5e-8cc0-436a-8137-faf3173c7307"],
    "originalEdd": null,
    "consignee": {
        "geoFence": null,
        "documents": null,
        "customFields": null,
        "isPortalEnabled": false,
        "type": null,
        "updates": null,
        "uuid": "FAKE",
        "orgId": "06acac7f-5697-4fef-9a61-eef47f75367a",
        "firmType": null,
        "gstn": null,
        "voterId": null,
        "verificationTicketId": null,
        "group": {
            "name": "Consignee",
            "partnerType": null,
            "uuid": null,
            "orgId": null
        },
        "address": null,
        "verificationStatus": null,
        "externalId": null,
        "panNumber": null,
        "aadharNo": null,
        "parentId": null,
        "places": [{
            "hubId": null,
            "boundary": null,
            "address": "A-25/1, Sahibabad, Ghaziabad, Uttar Pradesh 201010",
            "accessibility": "public",
            "addedBy": "06acac7f-5697-4fef-9a61-eef47f75367a",
            "center": {
                "latitude": 28.672407476298,
                "longitude": 77.375595175183
            },
            "suggestedRadius": 500,
            "isOwned": true,
            "centerCoordinates": [77.375595175183, 28.672407476298],
            "placeId": "c995f0b8-19c1-4236-8ef8-c732ef0c83fc",
            "geoJsonBoundry": null,
            "externalId": "",
            "source": "FRETRON",
            "places": null,
            "viewport": null,
            "district": null,
            "name": "Noida DC",
            "state": null,
            "category": "DC",
            "subDistrict": null,
            "controllingBranchId": null
        }],
        "route": null,
        "name": "Noida DC",
        "location": null,
        "fretronId": null,
        "contacts": null,
        "status": null
    },
    "address": null,
    "edd": null,
    "salesOffice": null,
    "consignmentDate": 1684912916981,
    "externalId": "2589537_11187657",
    "eWayBillExpiryDate": null,
    "activeShipment": "ab0e0c5e-8cc0-436a-8137-faf3173c7307",
    "consignmentNo": "2589537_11187657",
    "currentLocation": {
        "latitude": 0,
        "longitude": 28.588136
    },
    "billToParty": null,
    "equipments": null,
    "orderMappings": [
        {
            "quantity": {
                "volume": null,
                "packageMeasurement": {
                    "actualDeliveredQuantity": null,
                    "density": null,
                    "netQuantity": 5,
                    "moisture": null,
                    "claimQuantity": null,
                    "unitOfMeasurment": "unit",
                    "standardQuantity": 5,
                    "actualLoadedQuantity": null,
                    "measurmentType": "package",
                    "grossQuantity": 5,
                    "shortage": null,
                    "temperature": null,
                    "plannedLoadQuantity": null,
                    "frieghtDeductableQuantity": null
                },
                "weight": null,
                "containers": null,
                "trucks": null
            },
            "orderId": null,
            "lineItemId": null,
            "legType": null,
            "consignmentId": null,
            "originLegId": null,
            "isFullyUtilized": null,
            "consignmentLineItemId": "66a136bd-a4a1-480e-8350-2a8d638a3648",
            "source": null,
            "containerId": null,
            "uuid": "bf9d54f4-cc05-4136-9fd2-8961b01be121",
            "fuMappings": null
        }, {
            "quantity": {
                "volume": null,
                "packageMeasurement": {
                    "actualDeliveredQuantity": null,
                    "density": null,
                    "netQuantity": 140,
                    "moisture": null,
                    "claimQuantity": null,
                    "unitOfMeasurment": "unit",
                    "standardQuantity": 140,
                    "actualLoadedQuantity": null,
                    "measurmentType": "package",
                    "grossQuantity": 140,
                    "shortage": null,
                    "temperature": null,
                    "plannedLoadQuantity": null,
                    "frieghtDeductableQuantity": null
                },
                "weight": null,
                "containers": null,
                "trucks": null
            },
            "orderId": null,
            "lineItemId": null,
            "legType": null,
            "consignmentId": null,
            "originLegId": null,
            "isFullyUtilized": null,
            "consignmentLineItemId": "5bfbda22-f5cb-4fd1-95c3-bb2b619fa06f",
            "source": null,
            "containerId": null,
            "uuid": "a78cf19c-84f4-45a5-9405-fa073ec46efb",
            "fuMappings": null
        }, {
            "quantity": {
                "volume": null,
                "packageMeasurement": {
                    "actualDeliveredQuantity": null,
                    "density": null,
                    "netQuantity": 6,
                    "moisture": null,
                    "claimQuantity": null,
                    "unitOfMeasurment": "unit",
                    "standardQuantity": 6,
                    "actualLoadedQuantity": null,
                    "measurmentType": "package",
                    "grossQuantity": 6,
                    "shortage": null,
                    "temperature": null,
                    "plannedLoadQuantity": null,
                    "frieghtDeductableQuantity": null
                },
                "weight": null,
                "containers": null,
                "trucks": null
            },
            "orderId": null,
            "lineItemId": null,
            "legType": null,
            "consignmentId": null,
            "originLegId": null,
            "isFullyUtilized": null,
            "consignmentLineItemId": "0646fd63-4d53-416a-a0f2-6db1f6e48563",
            "source": null,
            "containerId": null,
            "uuid": "c0b305ec-995b-4d2c-8605-6c44217ead37",
            "fuMappings": null
        }],
    "contractId": null,
    "workOrderNumber": null,
    "trackingStatus": "In Transit to Noida DC",
    "eWayBillRegistrationDate": null,
    "contractToParty": null,
    "invoiceStatus": null,
    "poNumber": null,
    "status": "In Transit"
}

var arr = []
$event.lineItems.forEach(function (item) {
    let Map = {};
    // Map[item.material.name] = item.uuid;
    Map["materialName"] = item.material.name
    Map["lineItem"] = item.uuid
    arr.push(Map)
});
// console.log(arr);

var final_arr = []
var orderMappings = $event.orderMappings
for (let items of orderMappings) {
    let id = items.consignmentLineItemId
    let obj = arr.find(v => v.lineItem === id)

    let materialName = obj.materialName

    let quantity = items.quantity
    const NetQuantity =
        quantity?.volume?.netQuantity
        ?? quantity?.packageMeasurement?.netQuantity
        ?? quantity?.weight?.netQuantity
        ?? quantity?.containers?.netQuantity
        ?? quantity?.trucks?.netQuantity
        ?? 0




    let map = {};

    map["Fieldkey"] = materialName + "_Quantity"
    map["value"] = NetQuantity
    final_arr.push(map)

}
var newarr = []
arr.forEach(function (item) {
    newarr.push(item.materialName)
});
final_arr.push({
    "Fieldkey": "Material Names",
    "value": newarr.join(", ")
})
// console.log(final_arr);

var cfsArray = [
    {
        "indexedValue": [],
        "fieldKey": "Material Names",
        "multiple": false,
        "description": "Material Names",
        "remark": "",
        "uuid": null,
        "required": false,
        "accessType": null,
        "input": "string",
        "unit": "",
        "valueType": "string",
        "options": [],
        "fieldType": "text",
        "value": null,
        "isRemark": false
    }, {
        "indexedValue": [],
        "fieldKey": "Quantity",
        "multiple": false,
        "description": "Quantity",
        "remark": "",
        "uuid": null,
        "required": false,
        "accessType": null,
        "input": "string",
        "unit": "",
        "valueType": "string",
        "options": [],
        "fieldType": "text",
        "value": null,
        "isRemark": false
    }

]

let finalCustomFieldArray = []
// console.log(final_arr)

for (val of final_arr) {
    let cfMap = cfsArray.find(v => v.fieldKey == val.Fieldkey || val.Fieldkey.toLowerCase().includes(v.fieldKey.toLowerCase()))
    if (cfMap) {
        let obj = JSON.parse(JSON.stringify(cfMap))
        // let obj = cfMap
        obj.fieldKey = val.Fieldkey
        obj.value = val.value
        finalCustomFieldArray.push(obj)
    }
}

console.log(finalCustomFieldArray)


